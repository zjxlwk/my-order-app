<!-- 接单员仪表盘页面 -->
<view class="container">
  <!-- 头部信息 -->
  <view class="header">
    <view class="header-title">接单员工作台</view>
    <view class="header-user">
      <text class="header-username">{{currentUser}}</text>
      <text bindtap="logout" class="header-logout">退出</text>
    </view>
  </view>

  <!-- 错误提示 -->
  <view class="error-message" wx:if="{{error}}">{{error}}</view>

  <!-- 订单统计卡片 -->
  <view class="stats-cards">
    <view class="stat-card total" bindtap="showOrderDetails" data-status="all">
      <view class="stat-value">{{orderStats.total}}</view>
      <view class="stat-label">总订单数</view>
    </view>
    <!-- 待接单卡片：点击刷新并显示详情 -->
    <view class="stat-card pending" bindtap="refreshStats" data-status="pending">
      <view class="stat-value">{{orderStats.pending}}</view>
      <view class="stat-label">待接单</view>
    </view>
    <view class="stat-card delivering" bindtap="showOrderDetails" data-status="delivering">
      <view class="stat-value">{{orderStats.delivering}}</view>
      <view class="stat-label">配送中</view>
    </view>
    <view class="stat-card completed" bindtap="showOrderDetails" data-status="completed">
      <view class="stat-value">{{orderStats.completed}}</view>
      <view class="stat-label">已完成</view>
    </view>
  </view>
  
  <!-- 订单详情模态框 -->
  <view class="modal" wx:if="{{showModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">{{modalTitle}}</view>
        <view class="modal-close" bindtap="closeModal">×</view>
      </view>
      <view class="modal-body">
        <view class="empty" wx:if="{{modalOrders.length === 0}}">暂无相关订单</view>
        <view class="modal-order-item" wx:for="{{modalOrders}}" wx:key="id">
          <view class="modal-order-id">订单号: {{item.orderId || item._id}}</view>
          <view class="modal-order-info">
      <view>配送地址: {{item.deliveryAddress || '暂无地址信息'}}</view>
      <view>联系人: {{item.contactPerson || '暂无联系人信息'}}</view>
      <view>联系电话: {{item.contactPhone || '暂无联系电话'}}</view>
      <view>派单员: {{item.dispatcherName || '暂无派单员信息'}}</view>
      <view>接单员: {{item.receiverName || '暂无接单员信息'}}</view>
      <view>备注: {{item.note || '暂无备注信息'}}</view>
      <view class="modal-order-time">创建时间: {{item.createdAt}}</view>
    </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 搜索区域 -->
  <view class="search-section">
    <view class="search-form">
      <input 
        type="text" 
        placeholder="搜索订单号或配送地址"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
      />
      <button 
        type="primary" 
        size="mini" 
        bindtap="searchOrders"
      >搜索</button>
    </view>
  </view>

  <!-- 标签栏切换 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'pending' ? 'active' : ''}}"
      data-tab="pending"
      bindtap="switchTab"
    >
      待接单
    </view>
    <view 
      class="tab-item {{activeTab === 'delivering' ? 'active' : ''}}"
      data-tab="delivering"
      bindtap="switchTab"
    >
      配送中
    </view>
    <view 
      class="tab-item {{activeTab === 'completed' ? 'active' : ''}}"
      data-tab="completed"
      bindtap="switchTab"
    >
      已完成
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 待接单列表 -->
  <view class="order-list" wx:if="{{activeTab === 'pending' && !loading}}">
    <view class="empty" wx:if="{{pendingOrders.length === 0}}">暂无待接订单</view>
    <view class="order-card" wx:for="{{pendingOrders}}" wx:key="id">
      <view class="order-status-badge status-pending">待接单</view>
      <view class="order-header">
        <view class="order-id">订单号: {{item.orderId || item._id || '未知订单号'}}</view>
      </view>
      <view class="order-content">
        <view class="order-item">配送地址: {{item.deliveryAddress}}</view>
        <view class="order-item">联系人: {{item.contactPerson}}</view>
        <view class="order-item">联系电话: {{item.contactPhone}}</view>
        <view class="order-item">备注: {{item.note || '无'}}</view>
      </view>
      <view class="order-footer">
        <view class="order-time">创建时间: {{item.createdAt}}</view>
        <button 
          class="btn-accept" 
          size="mini" 
          data-orderId="{{item._id}}"
          bindtap="handleAcceptOrder"
        >立即接单</button>
      </view>
    </view>
  </view>

  <!-- 配送中列表 -->
  <view class="order-list" wx:if="{{activeTab === 'delivering' && !loading}}">
    <view class="empty" wx:if="{{deliveringOrders.length === 0}}">暂无配送中订单</view>
    <view class="order-card" wx:for="{{deliveringOrders}}" wx:key="id">
      <view class="order-status-badge status-delivering">配送中</view>
      <view class="order-header">
        <view class="order-id">订单号: {{item.orderId || item._id || '未知订单号'}}</view>
      </view>
      <view class="order-content">
        <view class="order-item">配送地址: {{item.deliveryAddress}}</view>
        <view class="order-item">联系人: {{item.contactPerson}}</view>
        <view class="order-item">联系电话: {{item.contactPhone}}</view>
      </view>
      <view class="order-footer">
        <view class="order-time">接单时间: {{item.acceptedAt}}</view>
        <button 
          class="btn-complete" 
          size="mini" 
          type="primary"
          data-order-id="{{item._id}}"
          bindtap="completeOrder"
        >标记完成</button>
      </view>
    </view>
  </view>

  <!-- 已完成列表 -->
  <view class="order-list" wx:if="{{activeTab === 'completed' && !loading}}">
    <view class="empty" wx:if="{{completedOrders.length === 0}}">暂无已完成订单</view>
    <view class="order-card" wx:for="{{completedOrders}}" wx:key="id">
      <view class="order-status-badge status-completed">已完成</view>
      <view class="order-header">
        <view class="order-id">订单号: {{item.orderId || item._id || '未知订单号'}}</view>
      </view>
      <view class="order-content">
        <view class="order-item">配送地址: {{item.deliveryAddress}}</view>
        <view class="order-item">联系人: {{item.contactPerson}}</view>
      </view>
      <view class="order-footer">
        <view class="order-time">完成时间: {{item.completedAt}}</view>
      </view>
    </view>
  </view>
</view>